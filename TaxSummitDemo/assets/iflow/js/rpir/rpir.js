/*! New York State Department of Taxation & Finance External Applications
 *  @description  Iflow External Applications
 *  @version      4.2.55.REL20180514
 *  @copyright    2018 New York State Department of Taxation & Finance
 */

var rpir=function(){var JADE_ACTION_aba="RPIR_DIRD01_RETRIEVE_BANK_NAME_ACTION",JADE_ACTION_schDist="RPIR_AINF01_RETRIEVE_SCHOOL_DIST",abaInput=null,abaBankNameDiv=null,abaBankNameInput=null,schDistLastRequestedCode="",schDistDropdown=null,_priv={},_init=function(){try{_priv._getAbaNumberInit(),_priv._getDistrictInit()}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}};return _priv._getAbaNumberInit=function(){try{if(abaInput=document.getElementById("ROUTING_NUMBER"))return uiUtil.attachEvent(abaInput,"blur",_priv._getAbaNumber),abaBankNameDiv=document.getElementById("bankNameDiv"),abaBankNameInput=document.getElementById("BANK_NAME"),!0}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}},_priv._getAbaNumber=function(){try{var settings,routingNum=uiUtil.trim(abaInput.value);routingNum.length?(settings={sUrl:"IFlowAjaxGatewayServlet",iTimeout:"",sMethod:"POST",oParams:"ROUTING_NUMBER="+routingNum+"&jadeAction="+JADE_ACTION_aba,sSpinElemId:"acctInfoGrp",onSuccessXtra:_priv._getAbaNumberAjaxSuccess,onError:_priv._getAbaNumberAjaxError,onTimeout:_priv._getAbaNumberAjaxError},uiMethods.buttons.mutex.disableAll(),uiMethods.ajax.execute(settings)):_priv._getAbaNumberClearBankName()}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}},_priv._getAbaNumberAjaxSuccess=function(xhr,oSettings){var response=null;try{"SUCCESS"===(response=JSON.parse(xhr.responseText)).status?(abaBankNameDiv.innerHTML=response.data.BANK_NAME,abaBankNameInput.value=response.data.BANK_NAME,uiUtil.setFocus("ACCOUNT_NUMBER")):/INVALID_CONTRACT|ERROR/.test(response.status)?_priv._getAbaNumberClearBankName():"FORWARD"===response.status&&(window.location.href=response.forwardPage)}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}finally{uiMethods.buttons.mutex.enableAll(),response.userMessages&&(uiMethods.iFlowMessages.oJSON=response.userMessages,uiMethods.iFlowMessages.display())}},_priv._getAbaNumberAjaxError=function(){try{window.location.href="error.jsp"}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}},_priv._getAbaNumberClearBankName=function(){try{abaBankNameDiv.innerHTML="",abaBankNameInput.value=""}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}},_priv._getDistrictInit=function(){try{var dropdown=uiUtil.queryOne(".nysCountyResidence");dropdown&&uiUtil.attachEvent(dropdown,"change",_priv._getDistrict),schDistDropdown=document.getElementById("SCHOOL_DIST")}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}},_priv._getDistrict=function(ev){try{var element=uiUtil.getHTMLObjFromEvent(ev),countyCode="";element&&(countyCode=element.value,schDistLastRequestedCode=countyCode,uiMethods.ajax.execute({sUrl:"IFlowAjaxGatewayServlet",sMethod:"POST",oParams:"code="+countyCode+"&jadeAction="+JADE_ACTION_schDist,onSuccess:_priv._getDistrictAjaxSuccess,onError:_priv._getDistrictAjaxError}))}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}},_priv._getDistrictAjaxSuccess=function(xmlHTTP,settings){try{var json=JSON.parse(xmlHTTP.responseText),code=settings.oParams.substring(settings.oParams.indexOf("code=")+5,settings.oParams.indexOf("&"));return"FORWARD"===json.status&&(window.location.href=json.forwardPage),schDistLastRequestedCode!==code?!1:(_priv._resetSchoolDistrictList(),json.schoolDistricts.forEach(function(district,i){schDistDropdown.options[i]=new Option(district.name,district.code)}),json.schoolDistricts.length)}catch(e){return uiUtil.errorHandling.jsLog.addEntry(e,arguments),-1}},_priv._getDistrictAjaxError=function(xmlHTTP,settings){try{return uiMethods.iFlowMessages.oJSON='{ "iFlowMessages": { "pageMessages": [ { "type": "error", "description": "'+settings.sErrorMessage+'" } ], "formMessages": [] } }',uiMethods.iFlowMessages.display({oFocus:"errorMessages"}),_priv._resetSchoolDistrictList(!0),!0}catch(e){return uiUtil.errorHandling.jsLog.addEntry(e,arguments),!1}},_priv._resetSchoolDistrictList=function(addPlaceholder){try{for(;schDistDropdown.firstChild;)schDistDropdown.removeChild(schDistDropdown.firstChild);return addPlaceholder&&(schDistDropdown.options[0]=new Option("Select school district","00"),schDistDropdown.options[0].setAttribute("selected","selected")),!0}catch(e){return uiUtil.errorHandling.jsLog.addEntry(e,arguments),!1}},window.attachEvent||"function"!=typeof domready?uiUtil.attachEvent(window,"load",_init):domready(_init),{setCalendarCustomMinDate:function(idList,month,day,yearsAgo){try{var startDate,configs=[],ids=uiUtil.trim(idList,",").split(",");yearsAgo="number"==typeof yearsAgo?yearsAgo:120,startDate=(month=month||"01")+"/"+(day=day||"01")+"/"+((new Date).getFullYear()-yearsAgo),ids.forEach(function(id){configs.push({inputId:id,minDate:startDate})}),PLUGIN.calendar.customize({datePickers:configs})}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}},getVersion:function(){return"1.7.2.REL20140512"}}}();