/*! New York State Department of Taxation & Finance External Applications
 *  @description  Iflow External Applications
 *  @version      4.2.55.REL20180514
 *  @copyright    2018 New York State Department of Taxation & Finance
 */

var strl=strl||{};strl=function(){var LAST_REQUEST_CODE="",_priv={},_init=function(){try{var dropdown=uiUtil.queryOne(".strl-countyBorough");dropdown&&uiUtil.attachEvent(dropdown,"change",_priv._getCityTown)}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}};return _priv._getCityTown=function(ev){try{var element=uiUtil.getHTMLObjFromEvent(ev),coboCode="";element&&"N"!==(coboCode=element.value).substr(0,1)&&(LAST_REQUEST_CODE=coboCode,uiMethods.ajax.execute({sUrl:"IFlowAjaxGatewayServlet",sMethod:"POST",oParams:"code="+coboCode+"&jadeAction=STRL_CINF01_RETRIEVE_TOWN_CITY_ACTION",onSuccess:_priv._ajaxCityTownSuccess,onError:_priv._ajaxCityTownError}))}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}},_priv._ajaxCityTownSuccess=function(xmlHTTP,settings){try{var i,townCities,json=JSON.parse(xmlHTTP.responseText),j=0,code=settings.oParams.substring(settings.oParams.indexOf("code=")+5,settings.oParams.indexOf("&")),dropdown=document.getElementById("select");if("FORWARD"===json.status&&(window.location.href=json.forwardPage),LAST_REQUEST_CODE!==code)return!1;for(;dropdown.firstChild;)dropdown.removeChild(dropdown.firstChild);for(i=(townCities=json.data.townsCities).length;j<i;)dropdown.options[j]=new Option(townCities[j].name,townCities[j].code),j++}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}},_priv._ajaxCityTownError=function(xmlHTTP,settings){try{uiMethods.iFlowMessages.oJSON='{ "iFlowMessages": { "pageMessages": [ { "type": "error", "description": "'+settings.sErrorMessage+'" } ], "formMessages": [] } }',uiMethods.iFlowMessages.display({oFocus:"errorMessages"})}catch(e){uiUtil.errorHandling.jsLog.addEntry(e,arguments)}},window.attachEvent||"function"!=typeof domready?uiUtil.attachEvent(window,"load",_init):domready(_init),{init:_init}}();